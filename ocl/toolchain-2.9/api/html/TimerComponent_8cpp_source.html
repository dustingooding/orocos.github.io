<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OrocosComponentLibrary: TimerComponent.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OrocosComponentLibrary
   &#160;<span id="projectnumber">2.9.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_2bf509e06406cd9ea2d6c512dc2f73b7.html">orocos_toolchain</a></li><li class="navelem"><a class="el" href="dir_c33f910dc388f36598c3c47b45009daa.html">ocl</a></li><li class="navelem"><a class="el" href="dir_0dc8c1f407a4ebc6347e805ecf98b985.html">timer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">TimerComponent.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;TimerComponent.hpp&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;rtt/Logger.hpp&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Component_8hpp.html">ocl/Component.hpp</a>&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;ORO_CREATE_COMPONENT_TYPE()</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;ORO_LIST_COMPONENT_TYPE( <a class="code" href="namespaceOCL.html">OCL</a>::TimerComponent )</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;namespace <a class="code" href="namespaceOCL.html">OCL</a></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;{</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="keyword">using namespace </span><a class="code" href="namespaceRTT.html">RTT</a>;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="classOCL_1_1TimerComponent.html#a8faa9011fe86d4571db4d543207177cc">   14</a></span>&#160;    TimerComponent::TimerComponent( std::string name <span class="comment">/*= &quot;os::Timer&quot; */</span> )</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        : TaskContext( name, PreOperational ), port_timers(32), mtimeoutEvent(<span class="stringliteral">&quot;timeout&quot;</span>),</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;          mtimer( port_timers, mtimeoutEvent ),</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;          waitForCommand( <span class="stringliteral">&quot;waitFor&quot;</span>, &amp;<a class="code" href="classOCL_1_1TimerComponent.html">TimerComponent</a>::waitFor, this), <span class="comment">//, &amp;TimerComponent::isTimerExpired, this),</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;          waitCommand( <span class="stringliteral">&quot;wait&quot;</span>, &amp;<a class="code" href="classOCL_1_1TimerComponent.html">TimerComponent</a>::wait, this) <span class="comment">//&amp;TimerComponent::isTimerExpired, this)</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    {</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="comment">// Add the methods, methods make sure that they are</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        <span class="comment">// executed in the context of the (non realtime) caller.</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        this-&gt;addOperation(<span class="stringliteral">&quot;arm&quot;</span>, &amp;os::Timer::arm , &amp;mtimer, RTT::ClientThread).doc(<span class="stringliteral">&quot;Arm a single shot timer.&quot;</span>).arg(<span class="stringliteral">&quot;timerId&quot;</span>, <span class="stringliteral">&quot;A numeric id of the timer to arm.&quot;</span>).arg(<span class="stringliteral">&quot;delay&quot;</span>, <span class="stringliteral">&quot;The delay in seconds before it fires.&quot;</span>);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        this-&gt;addOperation(<span class="stringliteral">&quot;startTimer&quot;</span>, &amp;os::Timer::startTimer , &amp;mtimer, RTT::ClientThread).doc(<span class="stringliteral">&quot;Start a periodic timer.&quot;</span>).arg(<span class="stringliteral">&quot;timerId&quot;</span>, <span class="stringliteral">&quot;A numeric id of the timer to start.&quot;</span>).arg(<span class="stringliteral">&quot;period&quot;</span>, <span class="stringliteral">&quot;The period in seconds.&quot;</span>);</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        this-&gt;addOperation(<span class="stringliteral">&quot;killTimer&quot;</span>, &amp;os::Timer::killTimer , &amp;mtimer, RTT::ClientThread).doc(<span class="stringliteral">&quot;Kill (disable) an armed or started timer.&quot;</span>).arg(<span class="stringliteral">&quot;timerId&quot;</span>, <span class="stringliteral">&quot;A numeric id of the timer to kill.&quot;</span>);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        this-&gt;addOperation(<span class="stringliteral">&quot;isArmed&quot;</span>, &amp;os::Timer::isArmed , &amp;mtimer, RTT::ClientThread).doc(<span class="stringliteral">&quot;Check if a given timer is armed or started.&quot;</span>).arg(<span class="stringliteral">&quot;timerId&quot;</span>, <span class="stringliteral">&quot;A numeric id of the timer to check.&quot;</span>);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        this-&gt;addOperation(<span class="stringliteral">&quot;setMaxTimers&quot;</span>, &amp;os::Timer::setMaxTimers , &amp;mtimer, RTT::ClientThread).doc(<span class="stringliteral">&quot;Raise or lower the maximum amount of timers.&quot;</span>).arg(<span class="stringliteral">&quot;timers&quot;</span>, <span class="stringliteral">&quot;The largest amount of timers. The highest timerId is max-1.&quot;</span>);</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        this-&gt;addOperation( <a class="code" href="classOCL_1_1TimerComponent.html#a112434572c78a57f1ba1eb37aeac1b36">waitForCommand</a> ).doc(<span class="stringliteral">&quot;Wait until a timer expires.&quot;</span>).arg(<span class="stringliteral">&quot;timerId&quot;</span>, <span class="stringliteral">&quot;A numeric id of the timer to wait for.&quot;</span>);</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        this-&gt;addOperation( <a class="code" href="classOCL_1_1TimerComponent.html#abafd91c412237c0785fba58521e2c4d9">waitCommand</a> ).doc(<span class="stringliteral">&quot;Arm and wait until that timer expires.&quot;</span>).arg(<span class="stringliteral">&quot;timerId&quot;</span>, <span class="stringliteral">&quot;A numeric id of the timer to arm and to wait for.&quot;</span>).arg(<span class="stringliteral">&quot;delay&quot;</span>, <span class="stringliteral">&quot;The delay in seconds before the timer expires.&quot;</span>);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        this-&gt;addPort(mtimeoutEvent).doc(<span class="stringliteral">&quot;This port is written each time ANY timer expires. The timer id is the value sent in this port. This port is for backwards compatibility only. It is advised to use the timer_* ports.&quot;</span>);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;port_timers.size();i++){</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            ostringstream port_name;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            port_name&lt;&lt;<span class="stringliteral">&quot;timer_&quot;</span>&lt;&lt;i;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            port_timers[i] = <span class="keyword">new</span> RTT::OutputPort&lt;RTT::os::Timer::TimerId&gt;(port_name.str());</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            this-&gt;addPort(*(port_timers[i])).doc(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;This port is written each time &quot;</span>)+port_name.str()+string(<span class="stringliteral">&quot; expires. The timer id is the value sent in this port.&quot;</span>));</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    TimerComponent::~TimerComponent() {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        this-&gt;stop();</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;port_timers.size();i++)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            <span class="keyword">delete</span> port_timers[i];</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classOCL_1_1TimerComponent.html#a5f2113dc0abce88090d04313486c6be5">   46</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classOCL_1_1TimerComponent.html#a5f2113dc0abce88090d04313486c6be5">TimerComponent::startHook</a>()</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">return</span> mtimer.getThread() &amp;&amp; mtimer.getThread()-&gt;start();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">void</span> TimerComponent::updateHook()</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">// nop, we just process the wait commands.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordtype">void</span> TimerComponent::stopHook()</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        mtimer.getThread()-&gt;stop();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="classOCL_1_1TimerComponent.html#a41e99d24c91e06e46b58cf7ec6b9608b">   61</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classOCL_1_1TimerComponent.html#a41e99d24c91e06e46b58cf7ec6b9608b">TimerComponent::wait</a>(RTT::os::Timer::TimerId <span class="keywordtype">id</span>, <span class="keywordtype">double</span> seconds)</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordflow">return</span> mtimer.arm(<span class="keywordtype">id</span>, seconds) &amp;&amp; mtimer.waitFor(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="classOCL_1_1TimerComponent.html#a2f02a94932fdc275882bcdbcab499822">   66</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classOCL_1_1TimerComponent.html#a2f02a94932fdc275882bcdbcab499822">TimerComponent::waitFor</a>(RTT::os::Timer::TimerId <span class="keywordtype">id</span>)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">return</span> mtimer.waitFor(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classOCL_1_1TimerComponent.html#a484a7bcce887599cc29ed94e27642ece">   71</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classOCL_1_1TimerComponent.html#a484a7bcce887599cc29ed94e27642ece">TimerComponent::isTimerExpired</a>(RTT::os::Timer::TimerId <span class="keywordtype">id</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">return</span> !mtimer.isArmed(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div><div class="ttc" id="classOCL_1_1TimerComponent_html_a5f2113dc0abce88090d04313486c6be5"><div class="ttname"><a href="classOCL_1_1TimerComponent.html#a5f2113dc0abce88090d04313486c6be5">OCL::TimerComponent::startHook</a></div><div class="ttdeci">bool startHook()</div><div class="ttdoc">This hook will check if a Activity has been properly setup. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8cpp_source.html#l00046">TimerComponent.cpp:46</a></div></div>
<div class="ttc" id="classOCL_1_1TimerComponent_html_a112434572c78a57f1ba1eb37aeac1b36"><div class="ttname"><a href="classOCL_1_1TimerComponent.html#a112434572c78a57f1ba1eb37aeac1b36">OCL::TimerComponent::waitForCommand</a></div><div class="ttdeci">RTT::Operation&lt; bool(RTT::os::Timer::TimerId)&gt; waitForCommand</div><div class="ttdoc">Command: wait until a timer expires. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8hpp_source.html#l00057">TimerComponent.hpp:57</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="Component_8hpp_html"><div class="ttname"><a href="Component_8hpp.html">Component.hpp</a></div><div class="ttdoc">This file contains the macros and definitions to create dynamically loadable components. </div></div>
<div class="ttc" id="classOCL_1_1TimerComponent_html_a41e99d24c91e06e46b58cf7ec6b9608b"><div class="ttname"><a href="classOCL_1_1TimerComponent.html#a41e99d24c91e06e46b58cf7ec6b9608b">OCL::TimerComponent::wait</a></div><div class="ttdeci">bool wait(RTT::os::Timer::TimerId id, double seconds)</div><div class="ttdoc">Command Implementation: arm and wait until a timer expires. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8cpp_source.html#l00061">TimerComponent.cpp:61</a></div></div>
<div class="ttc" id="classOCL_1_1TimerComponent_html"><div class="ttname"><a href="classOCL_1_1TimerComponent.html">OCL::TimerComponent</a></div><div class="ttdoc">A Component interface to the Real-Time types::Toolkit&amp;#39;s timer. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8hpp_source.html#l00021">TimerComponent.hpp:21</a></div></div>
<div class="ttc" id="namespaceOCL_html"><div class="ttname"><a href="namespaceOCL.html">OCL</a></div><div class="ttdoc">The Orocos Component Library. </div><div class="ttdef"><b>Definition:</b> <a href="Component_8hpp_source.html#l00043">Component.hpp:43</a></div></div>
<div class="ttc" id="classOCL_1_1TimerComponent_html_abafd91c412237c0785fba58521e2c4d9"><div class="ttname"><a href="classOCL_1_1TimerComponent.html#abafd91c412237c0785fba58521e2c4d9">OCL::TimerComponent::waitCommand</a></div><div class="ttdeci">RTT::Operation&lt; bool(RTT::os::Timer::TimerId, double)&gt; waitCommand</div><div class="ttdoc">Command: arm and wait until a timer expires. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8hpp_source.html#l00062">TimerComponent.hpp:62</a></div></div>
<div class="ttc" id="classOCL_1_1TimerComponent_html_a484a7bcce887599cc29ed94e27642ece"><div class="ttname"><a href="classOCL_1_1TimerComponent.html#a484a7bcce887599cc29ed94e27642ece">OCL::TimerComponent::isTimerExpired</a></div><div class="ttdeci">bool isTimerExpired(RTT::os::Timer::TimerId id) const </div><div class="ttdoc">Command Condition: return true if id expired. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8cpp_source.html#l00071">TimerComponent.cpp:71</a></div></div>
<div class="ttc" id="classOCL_1_1TimerComponent_html_a2f02a94932fdc275882bcdbcab499822"><div class="ttname"><a href="classOCL_1_1TimerComponent.html#a2f02a94932fdc275882bcdbcab499822">OCL::TimerComponent::waitFor</a></div><div class="ttdeci">bool waitFor(RTT::os::Timer::TimerId id)</div><div class="ttdoc">Command Implementation: wait until a timer expires. </div><div class="ttdef"><b>Definition:</b> <a href="TimerComponent_8cpp_source.html#l00066">TimerComponent.cpp:66</a></div></div>
<div class="ttc" id="namespaceRTT_html"><div class="ttname"><a href="namespaceRTT.html">RTT</a></div><div class="ttdef"><b>Definition:</b> <a href="Category_8hpp_source.html#l00010">Category.hpp:10</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
